---
title: "p8105_fp_ds100_Report"
author: "Yue Gu, Jianghui Lin, Junyuan Zheng, Jianyou Liu, Zhiqian Fang"
date: "12/3/2018"
output: github_document
---

```{r import_packages, echo = FALSE, message = FALSE}
library(tidyverse)
library(plotly)
library(patchwork)
```

```{r data_import, message = FALSE}
data_BRFSS = 
  read_csv(file = './data/brfss_data.csv')
data_IM = 
  read_csv(file = './data/NCHS_-_Injury_Mortality__United_States.csv')
```

# Motivation:
(Provide an overview of the project goals and motivation.)

Suicide is a leading cause of death in the US. Suicide rates increased in nearly every state from 1999 through 2016. Mental health conditions are often seen as the cause of suicide, but suicide is rarely caused by any single factor. In fact, many people who die by suicide are not known to have a diagnosed mental health condition at the time of death. We are interested in examining the variations of suicide death rates among different categorical variables such as gender, race, age group, and to test if the observed differences are statistically significant combined with the analysis to age-specific rate and related confidence interval.

# Related work:
Anything that inspired you, such as a paper, a web site, or something we discussed in class.


# Initial questions:
(What questions are you trying to answer? How did these questions evolve over the course of the project? What new questions did you consider in the course of your analysis?)

The initial thought of this project is to discover the relationship between suicide and people's mental status. However, we only found two seperated datasets, in which one is the Injury Mortality data in the US, the other contains people's depression status in the US. Since both of the two dataset contains information about age, race, and gender, we decided to compare the trend of suicide death rate with depression prevalence under these three categories.

# Data:
Source, scraping method, cleaning, etc.


# Exploratory analysis:

(Visualizations, summaries, and exploratory statistical analyses. Justify the steps you took, and show any major changes to your ideas.)

Creat a new data from the original data just for this section, so that it won't affect other part of the analysis:
For BRFSS dataset, select some variables that might be usful for later analysis:
```{r tidy_data_BRFSS}
data_BRFSS_JZ = data_BRFSS %>% 
  janitor::clean_names(.) %>% 
  select(., year, locationabbr, locationdesc, response, sample_size, age_group, gender, race_ethnicity)
```
For the Injury Mortality dataset, filter out 'Suicide' as our focus. Get rid of summarized rows for age, sex and race. Since the cases and total population do not differ by 'injury_mechanism', here I use 'All Mechanisms' to prevend over counting for the population. 
```{r tidy_data_IM}
data_IM_JZ = data_IM %>% 
  janitor::clean_names(.) %>% 
  filter(., injury_intent == 'Suicide',
    year == 2011 | year == 2012 | year == 2013 | year == 2014 | year == 2015 | year == 2016,
    sex != 'Both sexes',
    age_group_years != 'All Ages',
    race != 'All races',
    injury_mechanism == 'All Mechanisms')
```

__Exploring by 'Age':__

```{r BRFSS_IM_year_age}
BRFSS_age_plot = 
data_BRFSS_JZ %>% 
  filter(., age_group != 'NA') %>% 
  group_by(., year, response, age_group) %>% 
  summarize(., sum_sample_size = sum(sample_size)) %>% 
  spread(., key = age_group, value = sum_sample_size) %>% 
  mutate(., '25-44' = (`25-34` + `35-44`),
            '45-64' = (`45-54` + `55-64`)) %>% 
  select(., -'25-34', - '35-44', -'45-54', -'55-64') %>% 
  gather(., key = age, value = sample_size, '18-24':'45-64') %>% 
  spread(., key = response, value = sample_size) %>% 
  mutate(., prevalence = (Yes / (Yes + No)),
    ci_low = prevalence - qnorm(.975) * sqrt(prevalence * (1 - prevalence) / (Yes + No)),
    ci_high = prevalence + qnorm(.975) * sqrt(prevalence * (1 - prevalence) / (Yes + No))) %>% 
  ggplot(., aes(x = year, y = prevalence, color = age)) +
  geom_point() +
  geom_line() +
  geom_errorbar(aes(ymax = ci_high, ymin = ci_low), width = 0.1, alpha = 0.5) + 
  theme(legend.position = 'right', legend.text = element_text(size=6), legend.box = 'vertical',
        legend.key.size = unit(1, 'cm')) +
  ggtitle('Depression Prevalence by Age')

IM_age_plot = 
data_IM_JZ %>% 
  group_by(., year, age_group_years) %>% 
  summarize(., sum_deaths = sum(deaths), population = sum(population)) %>% 
  spread(., key = age_group_years, value = sum_deaths) %>%
  mutate_all(funs(ifelse(is.na(.), 0, .))) %>%
  mutate(., '< 25' = (`< 15` + `15–24`),
            '> 64' = (`65–74` + `75+`)) %>% 
  select(., -'< 15', - '15–24', -'65–74', -'75+') %>%
  gather(., key = age, value = deaths, '25–44':'> 64') %>%
  filter(., deaths != 0) %>% 
  group_by(., year, age) %>% 
  summarize(., deaths = sum(deaths), population = sum(population)) %>% 
  mutate(., death_rate = (deaths / population),
    ci_low = death_rate - qnorm(.975) * sqrt(death_rate * (1 - death_rate) / population),
    ci_high = death_rate + qnorm(.975) * sqrt(death_rate * (1 - death_rate) / population)) %>%
  mutate(., age = forcats::fct_relevel(age, c('< 25', '25–44', '45–64', '> 64'))) %>% 
  ggplot(., aes(x = year, y = death_rate, color = age)) +
  geom_point() +
  geom_line() +
  geom_errorbar(aes(ymax = ci_high, ymin = ci_low), width = 0.1, alpha = 0.8) + 
  theme(legend.position = 'right', legend.text = element_text(size=6), legend.box = 'vertical',
        legend.key.size = unit(1, 'cm')) +
  ggtitle('Suicide Death Rate by Age')

BRFSS_age_plot + IM_age_plot
```
One defect of this analysis is that the BRFSS data only includes 18-24 age group compared to '< 25' age group in the mortality dataset. If we just look at the other three age groups, for people from 25-64, high prevalence of depression seems to be consistant with suicide death rate. However, regardless of age group '65+' having a relative low depression prevalence, their suicide rate remains relatively high.

__Exploring by 'Race':__

```{r BRFSS_IM_year_race}
BRFSS_race_plot =
data_BRFSS_JZ %>% 
  filter(., race_ethnicity != 'NA') %>% 
  group_by(., year, response, race_ethnicity) %>% 
  summarize(., sum_sample_size = sum(sample_size)) %>% 
  spread(., key = race_ethnicity, value = sum_sample_size) %>%
  mutate(., Other = sum(c(`American Indian or Alaskan Native, non-Hispanic`, 
                         `Asian, non-Hispanic`, `Multiracial, non-Hispanic`,
                  `Native Hawaiian or other Pacific Islander, non-Hispanic`,
                                                     `Other, non-Hispanic`), na.rm = TRUE)) %>%   select(., -'American Indian or Alaskan Native, non-Hispanic',
            - 'Asian, non-Hispanic', -'Multiracial, non-Hispanic',
            -'Native Hawaiian or other Pacific Islander, non-Hispanic',
            -'Other, non-Hispanic') %>%
  gather(., key = race, value = sample_size, 'Black, non-Hispanic':'Other') %>% 
  spread(., key = response, value = sample_size) %>% 
  mutate(., prevalence = (Yes / (Yes + No)),
    ci_low = prevalence - qnorm(.975) * sqrt(prevalence * (1 - prevalence) / (Yes + No)),
    ci_high = prevalence + qnorm(.975) * sqrt(prevalence * (1 - prevalence) / (Yes + No))) %>%
  mutate(., race = forcats::fct_relevel(race,
                     c('Hispanic', 'Black, non-Hispanic', 'White, non-Hispanic', 'Other'))) %>%
  ggplot(., aes(x = year, y = prevalence, color = race)) +
  geom_point() +
  geom_line() +
  geom_errorbar(aes(ymax = ci_high, ymin = ci_low), width = 0.1, alpha = 0.8) + 
  theme(legend.position = 'right', legend.text = element_text(size=6), legend.box = 'vertical',
        legend.key.size = unit(1, 'cm')) +
  ggtitle('Depression Prevalence from by Race')

IM_race_plot =
data_IM_JZ %>% 
  group_by(., year, race) %>%
  summarize(., sum_deaths = sum(deaths), population = sum(population)) %>% 
  mutate(., death_rate = (sum_deaths / population),
    ci_low = death_rate - qnorm(.975) * sqrt(death_rate * (1 - death_rate) / population),
    ci_high = death_rate + qnorm(.975) * sqrt(death_rate * (1 - death_rate) / population)) %>% 
  ggplot(., aes(x = year, y = death_rate, color = race)) +
  geom_point() +
  geom_line() +
  geom_errorbar(aes(ymax = ci_high, ymin = ci_low), width = 0.5, alpha = 0.5) + 
  theme(legend.position = 'right', legend.text = element_text(size=6), legend.box = 'vertical',
        legend.key.size = unit(1, 'cm')) +
  ggtitle('Suicide Death Rate by Age')

BRFSS_race_plot / IM_race_plot
```

__Exploring by 'Gender':__

```{r BRFSS_IM_year_gender}
BRFSS_gender_plot = 
data_BRFSS_JZ %>% 
  filter(., gender != 'NA') %>% 
  group_by(., year, gender, response) %>% 
  summarize(., sum_sample_size = sum(sample_size)) %>% 
  spread(., key = response, value = sum_sample_size) %>% 
  mutate(., prevalence = (Yes / (Yes + No)),
    ci_low = prevalence - qnorm(.975) * sqrt(prevalence * (1 - prevalence) / (Yes + No)),
    ci_high = prevalence + qnorm(.975) * sqrt(prevalence * (1 - prevalence) / (Yes + No))) %>% 
  ggplot(., aes(x = year, y = prevalence, color = gender)) +
  geom_point() +
  geom_line() +
  geom_errorbar(aes(ymax = ci_high, ymin = ci_low), width = 0.5, alpha = 1) +
  theme(legend.position = 'right', legend.text = element_text(size=6), legend.box = 'vertical',
        legend.key.size = unit(1, 'cm')) +
  ggtitle('Depression Prevalence by Genders')

IM_gender_plot = 
data_IM_JZ %>% 
  group_by(., year, sex) %>% 
  summarize(., sum_deaths = sum(deaths), population = sum(population)) %>% 
  mutate(., death_rate = (sum_deaths / population),
    ci_low = death_rate - qnorm(.975) * sqrt(death_rate * (1 - death_rate) / population),
    ci_high = death_rate + qnorm(.975) * sqrt(death_rate * (1 - death_rate) / population)) %>% 
  ggplot(., aes(x = year, y = death_rate, color = sex)) +
  geom_point() +
  geom_line() +
  geom_errorbar(aes(ymax = ci_high, ymin = ci_low), width = 0.5, alpha = 0.8) + 
  theme(legend.position = 'right', legend.text = element_text(size=6), legend.box = 'vertical',
        legend.key.size = unit(1, 'cm')) +
  ggtitle('Suicide Death Rate by Age')

BRFSS_gender_plot + IM_gender_plot
```

# Additional analysis:
If you undertake formal statistical analyses, describe these in detail


# Discussion:
What were your findings? Are they what you expect? What insights into the data can you make?